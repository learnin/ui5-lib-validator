sap.ui.define(["sap/base/util/uid","sap/m/CheckBox","sap/m/ColumnListItem","sap/m/IconTabFilter","sap/m/Input","sap/m/Table","sap/ui/base/Object","sap/ui/core/Control","sap/ui/core/Element","sap/ui/core/LabelEnablement","sap/ui/core/MessageType","sap/ui/core/ValueState","sap/ui/core/message/ControlMessageProcessor","sap/ui/core/message/Message","sap/ui/layout/form/FormContainer","sap/ui/layout/form/FormElement","sap/ui/table/Row","sap/ui/table/Table"],function(t,e,r,a,i,s,o,n,l,d,g,c,h,u,f,_,V,p){"use strict";const A=o.extend("learnin.ui5.validator.Validator",{constructor:function(t){o.apply(this,arguments);this.RESOURCE_BUNDLE_KEY_REQUIRED_INPUT="learnin.ui5.validator.Validator.message.requiredInput";this.RESOURCE_BUNDLE_KEY_REQUIRED_SELECT="learnin.ui5.validator.Validator.message.requiredSelect";this._CUSTOM_DATA_KEY_FOR_IS_SET_VALUE_STATE_ERROR="learnin.ui5.validator.Validator.IS_SET_VALUE_STATE_ERROR";this._aTargetAggregations=["items","content","form","formContainers","formElements","fields","sections","subSections","app","pages","_grid","_page","cells"];this._mRegisteredValidator=new Map;this._mControlIdAttachedValidator=new Map;if(t&&t.resourceBundle){this._resourceBundle=t.resourceBundle}if(t&&t.targetAggregations){if(Array.isArray(t.targetAggregations)){t.targetAggregations.forEach(t=>{if(!this._aTargetAggregations.includes(t)){this._aTargetAggregations.push(t)}})}else{if(!this._aTargetAggregations.includes(t.targetAggregations)){this._aTargetAggregations.push(t.targetAggregations)}}}this._useFocusoutValidation=true;if(t&&t.useFocusoutValidation===false){this._useFocusoutValidation=false}}});A.prototype.validate=function(t){if(this._useFocusoutValidation){this._attachValidator(t)}return this._validate(t)};A.prototype.removeErrors=function(t){if(!t){throw new SyntaxError}if(!t instanceof n&&!t instanceof f&&!t instanceof _&&!t instanceof a){return}const e=sap.ui.getCore().getMessageManager();const r=e.getMessageModel();const i=y.getMetadata().getName();const s=r.getProperty("/").filter(t=>o.isA(t,i));const d=t.getId();for(let t=0,r=s.length;t<r;t++){const r=s[t];const a=r.getValidationErrorControlIds();if(!a.some(t=>l.registry.get(t))){e.removeMessages(r);continue}a.forEach(t=>{const a=l.registry.get(t);if(this._isChildOrEqualControlId(a,d)){e.removeMessages(r)}})}l.registry.forEach((t,e)=>{if(this._isSetValueStateError(t)){if(this._isChildOrEqualControlId(t,d)){this._clearValueStateIfNoErrors(t,this._resolveMessageTarget(t))}}})};A.prototype.removeAttachedValidators=function(t){if(!t){throw new SyntaxError}if(!t instanceof n&&!t instanceof f&&!t instanceof _&&!t instanceof a){return}const e=t.getId();this._mControlIdAttachedValidator.forEach((t,r)=>{const a=l.registry.get(r);if(!a){return}if(this._isChildOrEqualControlId(a,e)){if(t.registered){this._detachRegisteredValidator(a)}if(t.notRegistered){this._detachNotRegisteredValidator(a)}}})};A.prototype.registerValidator=function(e,r,a,i,s,o){let n=false;if(typeof e!=="string"){o=s;s=i;i=a;a=r;r=e;e=t();n=true}if(!(!Array.isArray(i)&&!Array.isArray(a)||Array.isArray(i)&&!Array.isArray(a)||Array.isArray(i)&&Array.isArray(a)&&a.length==i.length)){throw new SyntaxError}if(Array.isArray(i)&&o&&o.controlsMoreAttachValidator){throw new SyntaxError}const l={isAttachFocusoutValidationImmediately:true,isGroupedTargetControls:false,controlsMoreAttachValidator:null};const d=Object.assign({},l,o);const g=t=>{const e=t.targetControlOrControls;if(r(e)){return true}const a=t.messageTextOrMessageTexts;const i=t.validateFunctionId;if(Array.isArray(e)){if(t.isGroupedTargetControls){const t=Array.isArray(a)?a[0]:a;this._addMessage(e,t,i);for(let r=0;r<e.length;r++){this._setValueState(e[r],c.Error,t)}return false}for(let t=0;t<e.length;t++){const r=Array.isArray(a)?a[t]:a;this._addMessage(e[t],r,i);this._setValueState(e[t],c.Error,r)}}else{this._addMessage(e,a,i);this._setValueState(e,c.Error,a)}return false};const h=s.getId();if(this._mRegisteredValidator.has(h)){const t=this._mRegisteredValidator.get(h);const s=t.find(t=>n&&t.isOriginalFunctionIdUndefined&&a===t.messageTextOrMessageTexts||!n&&!t.isOriginalFunctionIdUndefined&&t.validateFunctionId===e);if(s){s.testFunction=r;s.messageTextOrMessageTexts=a;s.targetControlOrControls=i;s.validateFunction=g;s.isGroupedTargetControls=d.isGroupedTargetControls;s.controlsMoreAttachValidator=d.controlsMoreAttachValidator;s.isOriginalFunctionIdUndefined=n}else{t.push({validateFunctionId:e,testFunction:r,messageTextOrMessageTexts:a,targetControlOrControls:i,validateFunction:g,isGroupedTargetControls:d.isGroupedTargetControls,controlsMoreAttachValidator:d.controlsMoreAttachValidator,isOriginalFunctionIdUndefined:n})}}else{this._mRegisteredValidator.set(h,[{validateFunctionId:e,testFunction:r,messageTextOrMessageTexts:a,targetControlOrControls:i,validateFunction:g,isGroupedTargetControls:d.isGroupedTargetControls,controlsMoreAttachValidator:d.controlsMoreAttachValidator,isOriginalFunctionIdUndefined:n}])}if(d.isAttachFocusoutValidationImmediately){this._attachRegisteredValidator(i,r,a,e,d.isGroupedTargetControls,d.controlsMoreAttachValidator)}return this};A.prototype.registerRequiredValidator=function(t,e,r,a,i){let s=false;if(typeof t!=="string"){i=a;a=r;r=e;e=t;s=true}const o={isAttachFocusoutValidationImmediately:false,isGroupedTargetControls:false,controlsMoreAttachValidator:null};const n=Object.assign({},o,i);let l;if(Array.isArray(r)){if(n.controlsMoreAttachValidator){throw new SyntaxError}if(n.isGroupedTargetControls){l=this._getRequiredErrorMessageTextByControl(r[0])}else{l=r.map(t=>this._getRequiredErrorMessageTextByControl(t))}}else{l=this._getRequiredErrorMessageTextByControl(r)}if(s){this.registerValidator(e,l,r,a,n)}else{this.registerValidator(t,e,l,r,a,n)}return this};A.prototype.unregisterValidator=function(t,e){const r=e.getId();if(!this._mRegisteredValidator.has(r)){return this}const a=this._mRegisteredValidator.get(r);const i=a.findIndex(e=>e.validateFunctionId===t);if(i>=0){a.splice(i,1)}if(a.length===0){this._mRegisteredValidator.delete(r)}return this};A.prototype._attachValidator=function(t){if(!(t instanceof n||t instanceof f||t instanceof _||t instanceof a)){return}if(d.isRequired(t)){this._attachNotRegisteredValidator(t)}if(this._mRegisteredValidator.has(t.getId())){this._mRegisteredValidator.get(t.getId()).forEach(t=>{this._attachRegisteredValidator(t.targetControlOrControls,t.testFunction,t.messageTextOrMessageTexts,t.validateFunctionId,t.isGroupedTargetControls,t.controlsMoreAttachValidator)})}if(t instanceof p&&t.getBinding()){const e=t.getRows();for(let r=0,a=t.getBinding().getLength();r<a;r++){const t=e[r].getCells();if(t){for(let e=0;e<t.length;e++){this._attachValidator(t[e])}}}}else{for(let e=0;e<this._aTargetAggregations.length;e++){const r=t.getAggregation(this._aTargetAggregations[e]);if(!r){continue}if(Array.isArray(r)){for(let t=0;t<r.length;t++){this._attachValidator(r[t])}}else{this._attachValidator(r)}}}};A.prototype._validate=function(t){let e=true;const r=t.getId();if(!((t instanceof n||t instanceof f||t instanceof _||t instanceof a)&&t.getVisible())){if(!this._callRegisteredValidator(r)){e=false}return e}if(t instanceof p&&t.getBinding()){const r=t.getRows();for(let a=0,i=t.getBinding().getLength();a<i;a++){const t=r[a].getCells();if(t){for(let r=0;r<t.length;r++){if(!this._validate(t[r])){e=false}}}}}else{if((t.getEnabled&&t.getEnabled()||!t.getEnabled)&&d.isRequired(t)){e=this._validateRequired(t)}for(let r=0;r<this._aTargetAggregations.length;r++){const a=t.getAggregation(this._aTargetAggregations[r]);if(!a){continue}if(Array.isArray(a)){for(let t=0;t<a.length;t++){if(!this._validate(a[t])){e=false}}}else{if(!this._validate(a)){e=false}}}}if(!this._callRegisteredValidator(r)){e=false}return e};A.prototype._callRegisteredValidator=function(t){let e=true;if(this._mRegisteredValidator.has(t)){this._mRegisteredValidator.get(t).forEach(t=>{if(!t.validateFunction(t)){e=false}})}return e};A.prototype._attachNotRegisteredValidator=function(t){if(!t.attachSelectionFinish&&!t.attachChange&&!t.attachSelect){return}const e=t.getId();if(this._isAttachedNotRegisteredValidator(e)||this._isAttachedRegisteredValidator(e)){return}const r=this._getRequiredErrorMessageTextByControl(t);if(t.attachSelectionFinish){t.attachSelectionFinish(r,this._notRegisteredValidator,this);this._markAttachedNotRegisteredValidator(e)}else if(t.attachChange){t.attachChange(r,this._notRegisteredValidator,this);this._markAttachedNotRegisteredValidator(e)}else if(t.attachSelect){t.attachSelect(r,this._notRegisteredValidator,this);this._markAttachedNotRegisteredValidator(e)}};A.prototype._attachRegisteredValidator=function(t,e,r,a,i,s){let o;if(!Array.isArray(t)){o=[t]}else if(t.length===0){return}else{o=t}for(let t=0;t<o.length;t++){const n=o[t];const l=n.getId();if(this._isAttachedNotRegisteredValidator(l)||this._isAttachedRegisteredValidator(l)){continue}let d;if(i){d=Array.isArray(r)?r[0]:r}else{d=Array.isArray(r)?r[t]:r}const g={targetControl:n,messageText:d,test:e,controls:o,validateFunctionId:a,isGroupedTargetControls:i,messageTextOrMessageTexts:r};if(n.attachSelectionFinish){n.attachSelectionFinish(g,this._registeredvalidator,this);this._markAttachedRegisteredValidator(l)}else if(n.attachChange){n.attachChange(g,this._registeredvalidator,this);this._markAttachedRegisteredValidator(l)}else if(n.attachSelect){n.attachSelect(g,this._registeredvalidator,this);this._markAttachedRegisteredValidator(l)}if(s&&t===0){let t;if(!Array.isArray(s)){t=[s]}else{t=s}for(let e=0;e<t.length;e++){const r=t[e];const a=r.getId();if(this._isAttachedNotRegisteredValidator(a)||this._isAttachedRegisteredValidator(a)){continue}if(r.attachSelectionFinish){r.attachSelectionFinish(g,this._registeredvalidator,this);this._markAttachedRegisteredValidator(a)}else if(r.attachChange){r.attachChange(g,this._registeredvalidator,this);this._markAttachedRegisteredValidator(a)}else if(r.attachSelect){r.attachSelect(g,this._registeredvalidator,this);this._markAttachedRegisteredValidator(a)}}}}};A.prototype._isAttachedNotRegisteredValidator=function(t){return this._isAttachedValidator(t,false)};A.prototype._isAttachedRegisteredValidator=function(t){return this._isAttachedValidator(t,true)};A.prototype._isAttachedValidator=function(t,e){const r=this._mControlIdAttachedValidator.get(t);if(!r){return false}if(e){return r.registered}return r.notRegistered};A.prototype._markAttachedNotRegisteredValidator=function(t){this._markAttachedValidator(t,false)};A.prototype._markAttachedRegisteredValidator=function(t){this._markAttachedValidator(t,true)};A.prototype._markAttachedValidator=function(t,e){const r=this._mControlIdAttachedValidator.get(t);if(r){if(e){r.registered=true}else{r.notRegistered=true}}else{this._mControlIdAttachedValidator.set(t,{registered:e,notRegistered:!e})}};A.prototype._unmarkAttachedNotRegisteredValidator=function(t){this._unmarkAttachedValidator(t,false)};A.prototype._unmarkAttachedRegisteredValidator=function(t){this._unmarkAttachedValidator(t,true)};A.prototype._unmarkAttachedValidator=function(t,e){const r=this._mControlIdAttachedValidator.get(t);if(!r){return}if(e){r.registered=false}else{r.notRegistered=false}};A.prototype._detachNotRegisteredValidator=function(t){const e=t.getId();if(t.detachSelectionFinish){t.detachSelectionFinish(this._notRegisteredValidator,this);this._unmarkAttachedNotRegisteredValidator(e)}else if(t.detachChange){t.detachChange(this._notRegisteredValidator,this);this._unmarkAttachedNotRegisteredValidator(e)}else if(t.detachSelect){t.detachSelect(this._notRegisteredValidator,this);this._unmarkAttachedNotRegisteredValidator(e)}};A.prototype._detachRegisteredValidator=function(t){const e=t.getId();if(t.detachSelectionFinish){t.detachSelectionFinish(this._registeredvalidator,this);this._unmarkAttachedRegisteredValidator(e)}else if(t.detachChange){t.detachChange(this._registeredvalidator,this);this._unmarkAttachedRegisteredValidator(e)}else if(t.detachSelect){t.detachSelect(this._registeredvalidator,this);this._unmarkAttachedRegisteredValidator(e)}};A.prototype._notRegisteredValidator=function(t,e){const r=t.getSource();if(this._isNullValue(r)){this._addMessage(r,e);this._setValueState(r,c.Error,e)}else{this._removeMessageAndValueState(r)}};A.prototype._registeredvalidator=function(t,e){const r=e.targetControl;const a=e.controls.length>1?e.controls:e.controls[0];if(e.test(a)){e.controls.forEach(t=>{this._removeMessageAndValueState(t,e.validateFunctionId)})}else{if(e.isGroupedTargetControls){this._addMessage(e.controls,e.messageText,e.validateFunctionId);e.controls.forEach(t=>{this._setValueState(t,c.Error,e.messageText)})}else{this._addMessage(r,e.messageText,e.validateFunctionId);this._setValueState(r,c.Error,e.messageText)}}};A.prototype._validateRequired=function(t){if(!this._isNullValue(t)){return true}const e=this._getRequiredErrorMessageTextByControl(t);this._addMessage(t,e);this._setValueState(t,c.Error,e);return false};A.prototype._removeMessageAndValueState=function(t,e){const r=sap.ui.getCore().getMessageManager();const a=r.getMessageModel();const i=y.getMetadata().getName();const s=t.getId();const n=a.getProperty("/").find(t=>o.isA(t,i)&&t.getValidationErrorControlIds().includes(s)&&t.getValidateFunctionId()===e);if(n){r.removeMessages(n)}this._clearValueStateIfNoErrors(t,this._resolveMessageTarget(t))};A.prototype._clearValueStateIfNoErrors=function(t,e){if(!t.setValueState){return}let r;if(!Array.isArray(e)){r=[e]}else if(e.length===0){return}else{r=e}const a=sap.ui.getCore().getMessageManager().getMessageModel().getProperty("/");r.forEach(e=>{if(!a.find(t=>{if(t.getTargets){return t.getTargets().includes(e)}return t.getTarget()===e})){this._setValueState(t,c.None,null)}})};A.prototype._isChildOrEqualControlId=function(t,e){if(t.getId()===e){return true}let r=t;while(r.getParent()){if(r.getParent().getId()===e){return true}r=r.getParent()}return false};A.prototype._resolveMessageTarget=function(t){let e=[];if(Array.isArray(t)){e=t}else{e.push(t)}const r=e.map(t=>{if(t.getBinding("value")||t.getValue){return t.getId()+"/value"}if(t.getBinding("selectedKey")||t.getSelectedKey){return t.getId()+"/selectedKey"}if(t.getBinding("selectedKeys")||t.getSelectedKeys){return t.getId()+"/selectedKeys"}if(t.getBinding("selected")||t.getSelected){return t.getId()+"/selected"}if(t.getBinding("selectedIndex")||t.getSelectedIndex){return t.getId()+"/selectedIndex"}if(t.getBinding("selectedDates")||t.getSelectedDates){return t.getId()+"/selectedDates"}return undefined});if(r.length>0){return r}return r[0]};A.prototype._isNullValue=function(t){if(!t.getValue&&!t.getSelectedKey&&!t.getSelectedKeys&&!t.getSelected&&!t.getSelectedIndex&&!t.getSelectedDates){return false}if(t.getValue||t.getSelectedKey||t.getSelectedKeys||t.getSelected){return!(t.getValue&&t.getValue()||t.getSelectedKey&&t.getSelectedKey()||t.getSelectedKeys&&t.getSelectedKeys().length>0||t.getSelected&&t.getSelected())}if(t.getSelectedIndex&&t.getSelectedIndex()>=0){return false}if(t.getSelectedDates){const e=t.getSelectedDates();if(e.length>0&&e[0].getStartDate()){return false}}return true};A.prototype._getRequiredErrorMessageTextByControl=function(t){const e="Required to input.";const r="Required to select.";if(t instanceof i){return this._getResourceText(this.RESOURCE_BUNDLE_KEY_REQUIRED_INPUT,e)}if(t.getSelectedKey||t.getSelectedKeys||t.getSelected||t.getSelectedIndex||t.getSelectedDates){return this._getResourceText(this.RESOURCE_BUNDLE_KEY_REQUIRED_SELECT,r)}return this._getResourceText(this.RESOURCE_BUNDLE_KEY_REQUIRED_INPUT,e)};A.prototype._getResourceText=function(t,e){if(this._resourceBundle){return this._resourceBundle.getText(t)}return e};A.prototype._getLabelText=function(t){if(t instanceof e&&t.getParent()){const e=d.getReferencingLabels(t.getParent());if(e&&e.length>0){const t=l.registry.get(e[0]);if(t&&t.getText){return t.getText()}}}if(t.getParent){const e=t.getParent();if(e instanceof V){const r=e;if(r.getParent()instanceof p){const e=r.getParent();const a=r.indexOfCell(t);if(a!==-1){const t=e.getColumns()[a].getLabel();if(typeof t==="string"){return t}else if(t.getText){return t.getText()}}}return undefined}else if(e instanceof r){const r=e;if(r.getParent()instanceof s){const e=r.getParent();const a=r.indexOfCell(t);if(a!==-1){const t=e.getColumns()[a].getHeader();if(t&&t.getText){return t.getText()}}}return undefined}}const a=d.getReferencingLabels(t);if(a&&a.length>0){const t=l.registry.get(a[0]);if(t&&t.getText){return t.getText()}}return undefined};A.prototype._addMessage=function(t,e,r){let a;let i;if(Array.isArray(t)){a=t[0];i=t}else{a=t;i=[t]}sap.ui.getCore().getMessageManager().addMessages(new y({message:e,type:g.Error,additionalText:this._getLabelText(a),processor:new h,target:this._resolveMessageTarget(t),validationErrorControlIds:i.map(t=>t.getId()),validateFunctionId:r}))};A.prototype._setValueState=function(t,e,r){if(t.setValueState){t.setValueState(e);if(e===c.Error){this._markSetValueStateError(t)}else if(e===c.None){this._unmarkSetValueStateError(t)}}if(t.setValueStateText){t.setValueStateText(r)}};A.prototype._isSetValueStateError=function(t){return t.data(this._CUSTOM_DATA_KEY_FOR_IS_SET_VALUE_STATE_ERROR)==="true"};A.prototype._markSetValueStateError=function(t){t.data(this._CUSTOM_DATA_KEY_FOR_IS_SET_VALUE_STATE_ERROR,"true")};A.prototype._unmarkSetValueStateError=function(t){t.data(this._CUSTOM_DATA_KEY_FOR_IS_SET_VALUE_STATE_ERROR,null)};const y=u.extend("learnin.ui5.validator.Validator._ValidatorMessage",{constructor:function(t){if(t&&Array.isArray(t.target)){if(!u.prototype.getTargets){this.targets=t.target;if(t.target.length>0){t.target=t.target[0]}else{delete t.target}u.call(this,t)}else{u.call(this,t)}}else{u.call(this,t)}this.validationErrorControlIds=[];if(t&&t.validationErrorControlIds&&Array.isArray(t.validationErrorControlIds)&&t.validationErrorControlIds.length>0){this.validationErrorControlIds=t.validationErrorControlIds;this.addControlId(t.validationErrorControlIds[0])}if(t&&t.validateFunctionId){this.validateFunctionId=t.validateFunctionId}}});y.prototype.getTargets=function(){if(u.prototype.getTargets){return u.prototype.getTargets.call(this)}return this.targets};y.prototype.getValidationErrorControlIds=function(){return this.validationErrorControlIds};y.prototype.getValidateFunctionId=function(){return this.validateFunctionId};return A});