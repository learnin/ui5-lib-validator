sap.ui.define(["sap/base/util/deepExtend","sap/base/util/uid","sap/m/CheckBox","sap/m/ColumnListItem","sap/m/IconTabFilter","sap/m/Input","sap/m/Table","sap/ui/base/Object","sap/ui/core/Control","sap/ui/core/Element","sap/ui/core/LabelEnablement","sap/ui/core/MessageType","sap/ui/core/ValueState","sap/ui/core/message/ControlMessageProcessor","sap/ui/core/message/Message","sap/ui/model/json/JSONModel","sap/ui/layout/form/FormContainer","sap/ui/layout/form/FormElement","sap/ui/table/Column","sap/ui/table/Row","sap/ui/table/Table"],function(e,t,r,s,a,i,o,n,l,d,g,c,u,h,f,_,p,I,T,C,y){"use strict";const V=(t,r,s)=>{let a;return i=>{if(a){clearTimeout(a)}const o=e({},i);a=setTimeout(()=>r.call(t,o),s)}};const A=n.extend("learnin.ui5.validator.Validator",{constructor:function(e){n.apply(this,arguments);this.RESOURCE_BUNDLE_KEY_REQUIRED_INPUT="learnin.ui5.validator.Validator.message.requiredInput";this.RESOURCE_BUNDLE_KEY_REQUIRED_SELECT="learnin.ui5.validator.Validator.message.requiredSelect";this._CUSTOM_DATA_KEY_FOR_IS_SET_VALUE_STATE_ERROR="learnin.ui5.validator.Validator.IS_SET_VALUE_STATE_ERROR";this._aTargetAggregations=["items","content","form","formContainers","formElements","fields","sections","subSections","app","pages","_grid","_page","cells"];this._mRegisteredValidator=new Map;this._mControlIdAttachedValidator=new Map;this._mInvalidTableRowCols=new Map;this._sTableIdAttachedRowsUpdated=new Set;this._fnDebouncedRenewValueStateInTable=null;if(e&&e.resourceBundle){this._resourceBundle=e.resourceBundle}if(e&&e.targetAggregations){if(Array.isArray(e.targetAggregations)){e.targetAggregations.forEach(e=>{if(!this._aTargetAggregations.includes(e)){this._aTargetAggregations.push(e)}})}else{if(!this._aTargetAggregations.includes(e.targetAggregations)){this._aTargetAggregations.push(e.targetAggregations)}}}this._useFocusoutValidation=true;if(e&&e.useFocusoutValidation===false){this._useFocusoutValidation=false}}});A.prototype.validate=function(e){if(this._useFocusoutValidation){this._attachValidator(e)}return this._validate(e)};A.prototype.removeErrors=function(e){if(!e){throw new SyntaxError}if(!e instanceof l&&!e instanceof p&&!e instanceof I&&!e instanceof a){return}const t=sap.ui.getCore().getMessageManager();const r=t.getMessageModel();const s=m.getMetadata().getName();const i=r.getProperty("/").filter(e=>n.isA(e,s));const o=e.getId();for(let e=0,r=i.length;e<r;e++){const r=i[e];const s=r.getValidationErrorControlIds();if(!s.some(e=>d.registry.get(e))){t.removeMessages(r);continue}s.forEach(e=>{const s=d.registry.get(e);if(this._isChildOrEqualControlId(s,o)){t.removeMessages(r)}})}this._mInvalidTableRowCols.forEach((e,t)=>{const r=d.registry.get(t);if(r&&this._isChildOrEqualControlId(r,o)){this._mInvalidTableRowCols.delete(t)}});d.registry.forEach((e,t)=>{if(this._isSetValueStateError(e)){if(this._isChildOrEqualControlId(e,o)){this._clearValueStateIfNoErrors(e,this._resolveMessageTarget(e))}}})};A.prototype.removeAttachedValidators=function(e){if(!e){throw new SyntaxError}if(!e instanceof l&&!e instanceof p&&!e instanceof I&&!e instanceof a){return}const t=e.getId();this._mControlIdAttachedValidator.forEach((e,r)=>{const s=d.registry.get(r);if(!s){return}if(this._isChildOrEqualControlId(s,t)){this._detachAllValidators(s)}});this._sTableIdAttachedRowsUpdated.forEach(e=>{const r=d.registry.get(e);if(!r){return}if(this._isChildOrEqualControlId(r,t)){if(this._fnDebouncedRenewValueStateInTable){r.detachRowsUpdated(this._fnDebouncedRenewValueStateInTable,this)}r.detachSort(this._clearInValidRowColsInTable,this);r.detachFilter(this._clearInValidRowColsInTable,this);r.detachModelContextChange(this._clearInValidRowColsInTable,this);this._sTableIdAttachedRowsUpdated.delete(e)}})};A.prototype.registerValidator=function(e,r,s,a,i,o){let n=false;if(typeof e!=="string"){o=i;i=a;a=s;s=r;r=e;e=t();n=true}if(!(!Array.isArray(a)&&!Array.isArray(s)||Array.isArray(a)&&!Array.isArray(s)||Array.isArray(a)&&Array.isArray(s)&&s.length==a.length)){throw new SyntaxError}if(Array.isArray(a)&&o&&o.controlsMoreAttachValidator){throw new SyntaxError}if(o&&!o.isAttachValidator&&o.isAttachFocusoutValidationImmediately){throw new SyntaxError}const l={isAttachValidator:true,isAttachFocusoutValidationImmediately:true,isGroupedTargetControls:false,controlsMoreAttachValidator:null};const d=Object.assign({},l,o);let g=false;let c;if(!Array.isArray(a)&&a instanceof T&&a.getParent().getBinding("rows")&&a.getParent().getBinding("rows").getModel()instanceof _||Array.isArray(a)&&a[0]instanceof T&&a[0].getParent().getBinding("rows")&&a[0].getParent().getBinding("rows").getModel()instanceof _){if(Array.isArray(a)&&d.isGroupedTargetControls){throw new SyntaxError}g=true;c=e=>{const t=Array.isArray(e.targetControlOrControls);let s=e.targetControlOrControls;if(!t){s=[s]}const a=s[0].getParent();const i=a.getBinding("rows");const o=i.getPath();const n=i.getModel().getProperty(o);const l=a.getRows();if(n.length===0||l.length===0){return true}const d=s.map(e=>e.getId());const g=[];a.getColumns().filter(e=>e.getVisible()).forEach((e,t)=>{if(d.includes(e.getId())){g.push(t)}});if(g.length===0){return true}const c=l[0].getCells().filter((e,t)=>g.includes(t));const u=c.map(e=>this._resolveBindingPropertyName(e));if(u.includes(undefined)){return true}const h=c.map(e=>this._getLabelText(e));let f=true;if(e.isGroupedTargetControls){const t=[];const a=[];for(let e=0,r=n.length;e<r;e++){t.push(n[e][c[0].getBindingPath(u[0])]);a.push(e)}if(!r(t)){f=false;this._addMessageAndInvalidTableRowCol(s,o,a,e.messageTextOrMessageTexts,h,e.validateFunctionId)}}else{for(let a=0,i=n.length;a<i;a++){let i;if(t){i=c.map((e,t)=>n[a][e.getBindingPath(u[t])])}else{i=n[a][c[0].getBindingPath(u[0])]}if(r(i)){continue}f=false;this._addMessageAndInvalidTableRowCol(s,o,[a],e.messageTextOrMessageTexts,h,e.validateFunctionId)}}return f}}else{c=e=>{const t=e.targetControlOrControls;if(r(t)){return true}const s=e.messageTextOrMessageTexts;const a=e.validateFunctionId;if(Array.isArray(t)){if(e.isGroupedTargetControls){const e=Array.isArray(s)?s[0]:s;this._addMessage(t,e,null,a);for(let r=0;r<t.length;r++){this._setValueState(t[r],u.Error,e)}return false}for(let e=0;e<t.length;e++){const r=Array.isArray(s)?s[e]:s;this._addMessage(t[e],r,null,a);this._setValueState(t[e],u.Error,r)}}else{this._addMessage(t,s,null,a);this._setValueState(t,u.Error,s)}return false}}const h=i.getId();if(this._mRegisteredValidator.has(h)){const t=this._mRegisteredValidator.get(h);const i=t.find(t=>n&&t.isOriginalFunctionIdUndefined&&s===t.messageTextOrMessageTexts||!n&&!t.isOriginalFunctionIdUndefined&&t.validateFunctionId===e);if(i){i.testFunction=r;i.messageTextOrMessageTexts=s;i.targetControlOrControls=a;i.validateFunction=c;i.isGroupedTargetControls=d.isGroupedTargetControls;i.controlsMoreAttachValidator=d.controlsMoreAttachValidator;i.isOriginalFunctionIdUndefined=n;i.isAttachValidator=d.isAttachValidator}else{t.push({validateFunctionId:e,testFunction:r,messageTextOrMessageTexts:s,targetControlOrControls:a,validateFunction:c,isGroupedTargetControls:d.isGroupedTargetControls,controlsMoreAttachValidator:d.controlsMoreAttachValidator,isOriginalFunctionIdUndefined:n,isAttachValidator:d.isAttachValidator})}}else{this._mRegisteredValidator.set(h,[{validateFunctionId:e,testFunction:r,messageTextOrMessageTexts:s,targetControlOrControls:a,validateFunction:c,isGroupedTargetControls:d.isGroupedTargetControls,controlsMoreAttachValidator:d.controlsMoreAttachValidator,isOriginalFunctionIdUndefined:n,isAttachValidator:d.isAttachValidator}])}if(d.isAttachValidator&&d.isAttachFocusoutValidationImmediately){if(g){if(Array.isArray(a)){const t=a;const i=t[0].getParent();const o=t.map(e=>e.getId());const n=[];i.getColumns().filter(e=>e.getVisible()).forEach((e,t)=>{if(o.includes(e.getId())){n.push(t)}});if(n.length>0){i.getRows().forEach(t=>{const a=t.getCells().filter((e,t)=>n.includes(t));this._attachRegisteredValidator(a,r,s,e,d.isGroupedTargetControls,d.controlsMoreAttachValidator)})}}else{const t=a;const i=t.getParent();const o=i.getColumns().filter(e=>e.getVisible()).findIndex(e=>e.getId()===t.getId());if(o>0){const t=i.getRows().map(e=>e.getCells()[o]);if(d.isGroupedTargetControls){this._attachRegisteredValidator(t,r,s,e,d.isGroupedTargetControls,d.controlsMoreAttachValidator)}else{t.forEach(t=>{this._attachRegisteredValidator(t,r,s,e,d.isGroupedTargetControls,d.controlsMoreAttachValidator)})}}}}else{this._attachRegisteredValidator(a,r,s,e,d.isGroupedTargetControls,d.controlsMoreAttachValidator)}}return this};A.prototype.registerRequiredValidator=function(e,t,r,s,a){let i=false;if(typeof e!=="string"){a=s;s=r;r=t;t=e;i=true}const o={isAttachFocusoutValidationImmediately:false,isGroupedTargetControls:false,controlsMoreAttachValidator:null};const n=Object.assign({},o,a);let l;if(Array.isArray(r)){if(n.controlsMoreAttachValidator){throw new SyntaxError}if(n.isGroupedTargetControls){l=this._getRequiredErrorMessageTextByControl(r[0])}else{l=r.map(e=>this._getRequiredErrorMessageTextByControl(e))}}else{l=this._getRequiredErrorMessageTextByControl(r)}if(i){this.registerValidator(t,l,r,s,n)}else{this.registerValidator(e,t,l,r,s,n)}return this};A.prototype.unregisterValidator=function(e,t){const r=t.getId();if(!this._mRegisteredValidator.has(r)){return this}const s=this._mRegisteredValidator.get(r);const a=s.findIndex(t=>t.validateFunctionId===e);if(a>=0){s.splice(a,1)}if(s.length===0){this._mRegisteredValidator.delete(r)}return this};A.prototype._attachValidator=function(e){if(!(e instanceof l||e instanceof p||e instanceof I||e instanceof a)){return}if(g.isRequired(e)){this._attachNotRegisteredValidator(e)}if(this._mRegisteredValidator.has(e.getId())){this._mRegisteredValidator.get(e.getId()).forEach(t=>{if(t.isAttachValidator){if(e instanceof y&&e.getBinding("rows")&&e.getBinding("rows").getModel()instanceof _){const r=e;if(Array.isArray(t.targetControlOrControls)){const e=t.targetControlOrControls;const s=e.map(e=>e.getId());const a=[];r.getColumns().filter(e=>e.getVisible()).forEach((e,t)=>{if(s.includes(e.getId())){a.push(t)}});if(a.length>0){r.getRows().forEach(e=>{const r=e.getCells().filter((e,t)=>a.includes(t));this._attachRegisteredValidator(r,t.testFunction,t.messageTextOrMessageTexts,t.validateFunctionId,t.isGroupedTargetControls,t.controlsMoreAttachValidator)})}}else{const e=t.targetControlOrControls;const s=r.getColumns().filter(e=>e.getVisible()).findIndex(t=>t.getId()===e.getId());if(s>0){const e=r.getRows().map(e=>e.getCells()[s]);if(t.isGroupedTargetControls){this._attachRegisteredValidator(e,t.testFunction,t.messageTextOrMessageTexts,t.validateFunctionId,t.isGroupedTargetControls,t.controlsMoreAttachValidator)}else{e.forEach(e=>{this._attachRegisteredValidator(e,t.testFunction,t.messageTextOrMessageTexts,t.validateFunctionId,t.isGroupedTargetControls,t.controlsMoreAttachValidator)})}}}}else{this._attachRegisteredValidator(t.targetControlOrControls,t.testFunction,t.messageTextOrMessageTexts,t.validateFunctionId,t.isGroupedTargetControls,t.controlsMoreAttachValidator)}}})}if(e instanceof y&&e.getBinding()){const t=e.getRows();for(let r=0,s=e.getBinding().getLength();r<s;r++){if(t[r]){const e=t[r].getCells();if(e){for(let t=0;t<e.length;t++){this._attachValidator(e[t])}}}}}else{for(let t=0;t<this._aTargetAggregations.length;t++){const r=e.getAggregation(this._aTargetAggregations[t]);if(!r){continue}if(Array.isArray(r)){for(let e=0;e<r.length;e++){this._attachValidator(r[e])}}else{this._attachValidator(r)}}}};A.prototype._validate=function(e){let t=true;const r=e.getId();if(!((e instanceof l||e instanceof p||e instanceof I||e instanceof a)&&e.getVisible())){if(!this._callRegisteredValidator(e)){t=false}return t}if(e instanceof y&&e.getBinding("rows")&&e.getBinding("rows").getModel()instanceof _){t=this._validateRequiredInSapUiTableTable(e)}else if(e instanceof y&&e.getBinding("rows")){const r=e.getRows();for(let s=0,a=e.getBinding().getLength();s<a;s++){if(r[s]){const e=r[s].getCells();if(e){for(let r=0;r<e.length;r++){if(!this._validate(e[r])){t=false}}}}}}else{if((e.getEnabled&&e.getEnabled()||!e.getEnabled)&&g.isRequired(e)){t=this._validateRequired(e)}for(let r=0;r<this._aTargetAggregations.length;r++){const s=e.getAggregation(this._aTargetAggregations[r]);if(!s){continue}if(Array.isArray(s)){for(let e=0;e<s.length;e++){if(!this._validate(s[e])){t=false}}}else{if(!this._validate(s)){t=false}}}}if(!this._callRegisteredValidator(e)){t=false}return t};A.prototype._toVisibledColumnIndex=function(e,t){const r=e.getColumns();const s=e=>{let t=0;for(let s=0,a=Math.min(r.length,e+1);s<a;s++){if(!r[s].getVisible()){t++}}return e-t};let a=t;let i=true;if(!Array.isArray(a)){i=false;a=[a]}const o=[];for(let e=0,t=a.length;e<t;e++){o.push(s(a[e]))}if(i){return o}return o[0]};A.prototype._renewValueStateInTable=function(e){const t=e.getSource();const r=this._mInvalidTableRowCols.get(t.getId());if(!r){return}const s=Array.from(new Set(r.map(e=>e.columnId)));let a=[];for(let e=0,r=s.length;e<r;e++){const r=d.registry.get(s[e]);if(!r||!r.getVisible()){continue}a.push(t.indexOfColumn(r))}a=this._toVisibledColumnIndex(t,a);const i=t.getRows();for(let e=0,t=a.length;e<t;e++){for(let t=0,r=i.length;t<r;t++){this._setValueState(i[t].getCells()[a[e]],u.None,null)}}const o=t.getBindingInfo("rows").model;for(let e=0,s=r.length;e<s;e++){const s=d.registry.get(r[e].columnId);if(!s||!s.getVisible()){continue}const a=this._toVisibledColumnIndex(t,t.indexOfColumn(s));const i=t.getRows().find(t=>t.getCells()[a].getBindingContext(o).getPath()===r[e].rowPath);if(i){const t=i.getCells()[a];this._setValueState(t,u.Error,r[e].message)}}};A.prototype._clearInValidRowColsInTable=function(e){const t=e.getSource().getId();if(this._mInvalidTableRowCols.has(t)){this._mInvalidTableRowCols.delete(t)}};A.prototype._addMessageAndInvalidTableRowCol=function(e,t,r,s,a,i){let o=false;e.forEach((e,a)=>{const n=e.getParent().getId();const l=e.getId();let d=this._mInvalidTableRowCols.get(n);if(!d){d=[];this._mInvalidTableRowCols.set(n,d)}r.forEach(e=>{if(!d.some(t=>t.rowIndex===e&&t.columnId===l&&t.validateFunctionId===i)){d.push({rowPath:`${t}/${e}`,rowIndex:e,columnId:l,message:s,validateFunctionId:i})}else if(a===0){o=true}})});if(!o){this._addMessage(e[0],s,`${t}/${r[0]}`,i,a.join(", "))}};A.prototype._attachTableRowsUpdater=function(e){if(this._sTableIdAttachedRowsUpdated.has(e.getId())){return}if(!this._fnDebouncedRenewValueStateInTable){this._fnDebouncedRenewValueStateInTable=V(this,this._renewValueStateInTable,100)}e.attachRowsUpdated(this._fnDebouncedRenewValueStateInTable,this);e.attachSort(this._clearInValidRowColsInTable,this);e.attachFilter(this._clearInValidRowColsInTable,this);e.attachModelContextChange(this._clearInValidRowColsInTable,this);this._sTableIdAttachedRowsUpdated.add(e.getId())};A.prototype._callRegisteredValidator=function(e){let t=true;const r=e.getId();let s=false;if(this._mRegisteredValidator.has(r)){this._mRegisteredValidator.get(r).forEach(r=>{if(!r.validateFunction(r)){t=false;if(e instanceof y){s=true}}})}if(s){this._attachTableRowsUpdater(e)}return t};A.prototype._attachNotRegisteredValidator=function(e){if(!e.attachSelectionFinish&&!e.attachChange&&!e.attachSelect){return}const t=e.getId();if(this._isAttachedValidator(t,"")){return}const r=this._getRequiredErrorMessageTextByControl(e);this._internalAttachValidator(e,"",r)};A.prototype._attachRegisteredValidator=function(e,t,r,s,a,i){let o;if(!Array.isArray(e)){o=[e]}else if(e.length===0){return}else{o=e}for(let e=0;e<o.length;e++){const n=o[e];const l=n.getId();if(this._isAttachedValidator(l,s)){continue}let d;if(a){d=Array.isArray(r)?r[0]:r}else{d=Array.isArray(r)?r[e]:r}const g={targetControl:n,messageText:d,test:t,controls:o,validateFunctionId:s,isGroupedTargetControls:a,messageTextOrMessageTexts:r};this._internalAttachValidator(n,s,g);if(i&&e===0){let e;if(!Array.isArray(i)){e=[i]}else{e=i}for(let t=0;t<e.length;t++){const r=e[t];const a=r.getId();if(this._isAttachedValidator(a,s)){continue}this._internalAttachValidator(r,s,g)}}}};A.prototype._isAttachedValidator=function(e,t){const r=this._mControlIdAttachedValidator.get(e);if(!r){return false}return r.includes(t)};A.prototype._internalAttachValidator=function(e,t,r){const s=e.getId();const a=()=>{const e=this._mControlIdAttachedValidator.get(s);if(e){e.push(t)}else{this._mControlIdAttachedValidator.set(s,[t])}};const i=t=>{if(e.attachSelectionFinish){e.attachSelectionFinish(r,t,this);a()}else if(e.attachChange){e.attachChange(r,t,this);a()}else if(e.attachSelect){e.attachSelect(r,t,this);a()}};if(t===""){i(this._notRegisteredValidator)}else{i(this._registeredvalidator)}};A.prototype._detachAllValidators=function(e){const t=e.getId();const r=this._mControlIdAttachedValidator.get();if(!r){return}const s=t=>{if(e.detachSelectionFinish){e.detachSelectionFinish(t,this)}else if(e.detachChange){e.detachChange(t,this)}else if(e.detachSelect){e.detachSelect(t,this)}};r.forEach(e=>{if(e===""){s(this._notRegisteredValidator)}else{s(this._registeredvalidator)}});this._mControlIdAttachedValidator.set(t,[])};A.prototype._notRegisteredValidator=function(e,t){const r=e.getSource();if(this._isNullValue(r)){if(this._isCellInSapUiTableTableBindedJsonModel(r)){this._setErrorCellInSapUiTableTable(r,t,"",false)}else{this._addMessage(r,t)}this._setValueState(r,u.Error,t)}else{if(this._isCellInSapUiTableTableBindedJsonModel(r)){this._clearErrorCellInSapUiTableTable(r,"",false)}else{this._removeMessageAndValueState(r,"")}}};A.prototype._registeredvalidator=function(e,t){const r=t.targetControl;const s=t.controls.length>1?t.controls:t.controls[0];let a;if(this._isCellInSapUiTableTableBindedJsonModel(r)&&t.isGroupedTargetControls){const e=r.getParent().getParent();const s=e.getBinding("rows");const i=s.getPath();const o=s.getModel().getProperty(i);const n=this._resolveBindingPropertyName(r);const l=[];for(let e=0;e<o.length;e++){l.push(o[e][r.getBindingPath(n)])}a=t.test(l)}else{a=t.test(s)}if(a){if(this._isCellInSapUiTableTableBindedJsonModel(r)){this._clearErrorCellInSapUiTableTable(t.controls,t.validateFunctionId,t.isGroupedTargetControls)}else{t.controls.forEach(e=>{this._removeMessageAndValueState(e,t.validateFunctionId)})}}else{if(this._isCellInSapUiTableTableBindedJsonModel(r)){this._setErrorCellInSapUiTableTable(t.controls,t.messageText,t.validateFunctionId,t.isGroupedTargetControls)}else if(t.isGroupedTargetControls){this._addMessage(t.controls,t.messageText,null,t.validateFunctionId);t.controls.forEach(e=>{this._setValueState(e,u.Error,t.messageText)})}else{this._addMessage(r,t.messageText,null,t.validateFunctionId);this._setValueState(r,u.Error,t.messageText)}}};A.prototype._isCellInSapUiTableTableBindedJsonModel=function(e){return e.getParent()&&e.getParent().getParent()instanceof y&&e.getParent().getParent().getBinding("rows")&&e.getParent().getParent().getBinding("rows").getModel()instanceof _};A.prototype._setErrorCellInSapUiTableTable=function(e,t,r,s){const a=Array.isArray(e)?e:[e];const i=a[0].getParent();const o=i.getParent();const n=a.map(e=>i.indexOfCell(e));const l=o.getColumns().filter(e=>e.getVisible()).filter((e,t)=>n.includes(t));const d=o.getBinding("rows");const g=d.getPath();const c=i.getIndex();const h=a.map(e=>this._getLabelText(e));let f=[c];if(Array.isArray(e)&&s){const e=d.getModel().getProperty(g).length;f=[];for(let t=0;t<e;t++){f.push(t)}}this._addMessageAndInvalidTableRowCol(l,g,f,t,h,r);a.forEach(e=>this._setValueState(e,u.Error,t));this._attachTableRowsUpdater(o)};A.prototype._clearErrorCellInSapUiTableTable=function(e,t,r){let s;if(!Array.isArray(e)){s=[e]}else if(r){s=[e[0]]}else{s=e}const a=s[0].getParent();const i=a.getParent();const o=i.getId();let l=this._mInvalidTableRowCols.get(o);if(!l){return}const d=s.map(e=>a.indexOfCell(e));const g=i.getColumns().filter(e=>e.getVisible()).filter((e,t)=>d.includes(t));const c=g.map(e=>e.getId());const u=i.getBindingInfo("rows").model;const h=i.getBinding("rows").getPath();const f=d.map(e=>a.getCells()[e].getBindingContext(u).getPath());if(Array.isArray(e)&&r){l=l.filter(e=>!c.includes(e.columnId)||e.validateFunctionId!==t)}else{l=l.filter(e=>!f.includes(e.rowPath)||!c.includes(e.columnId)||e.validateFunctionId!==t)}this._mInvalidTableRowCols.set(o,l);const _=sap.ui.getCore().getMessageManager();const p=_.getMessageModel();const I=m.getMetadata().getName();const T=p.getProperty("/").find(s=>n.isA(s,I)&&s.getControlId()===c[0]&&(Array.isArray(e)&&r&&s.fullTarget===`${h}/0`||f.includes(s.fullTarget))&&s.getValidateFunctionId()===t);if(T){_.removeMessages(T);if(Array.isArray(e)){e.forEach(e=>this._clearValueStateIfNoErrors(e,this._resolveMessageTarget(e)))}else{this._clearValueStateIfNoErrors(e,this._resolveMessageTarget(e))}}};A.prototype._validateRequired=function(e){if(!this._isNullValue(e)){return true}const t=this._getRequiredErrorMessageTextByControl(e);this._addMessage(e,t);this._setValueState(e,u.Error,t);return false};A.prototype._validateRequiredInSapUiTableTable=function(e){let t=true;const r=e.getBinding("rows");const s=r.getPath();const a=r.getModel().getProperty(s);const i=e.getRows();if(a.length>0&&i.length>0){const r=i[0].getCells().filter(e=>(e.getEnabled&&e.getEnabled()||!e.getEnabled)&&g.isRequired(e));if(r.length>0){const o=r.map(e=>this._resolveBindingPropertyName(e));for(let n=0;n<a.length;n++){for(let l=0;l<r.length;l++){if(!o[l]){continue}const d=a[n][r[l].getBindingPath(o[l])];if(o[l]==="selectedIndex"&&d<0||o[l]!=="selectedIndex"&&(d===""||d===null||d===undefined)){t=false;const a=this._getRequiredErrorMessageTextByControl(r[l]);const o=i[0].indexOfCell(r[l]);const d=e.getColumns().filter(e=>e.getVisible())[o];this._addMessageAndInvalidTableRowCol([d],s,[n],a,[this._getLabelText(r[l])],"")}}}}}if(!t){this._attachTableRowsUpdater(e)}e.fireRowsUpdated();return t};A.prototype._removeMessageAndValueState=function(e,t){const r=sap.ui.getCore().getMessageManager();const s=r.getMessageModel();const a=m.getMetadata().getName();const i=e.getId();const o=s.getProperty("/").find(e=>n.isA(e,a)&&e.getValidationErrorControlIds().includes(i)&&e.getValidateFunctionId()===t);if(o){r.removeMessages(o)}this._clearValueStateIfNoErrors(e,this._resolveMessageTarget(e))};A.prototype._clearValueStateIfNoErrors=function(e,t){if(!e.setValueState){return}let r;if(!Array.isArray(t)){r=[t]}else if(t.length===0){return}else{r=t}const s=sap.ui.getCore().getMessageManager().getMessageModel().getProperty("/");if(r.every(e=>s.some(t=>t.getTargets&&t.getTargets().includes(e)||t.getTarget()===e))){return}if(this._isCellInSapUiTableTableBindedJsonModel(e)){const t=e.getParent();const r=t.getParent();const s=r.getId();let a=this._mInvalidTableRowCols.get(s);if(!a){this._setValueState(e,u.None,null);return}const i=t.indexOfCell(e);const o=r.getColumns().filter(e=>e.getVisible())[i];const n=o.getId();const l=r.getBindingInfo("rows").model;const d=t.getCells()[i].getBindingContext(l).getPath();const g=a.find(e=>e.rowPath===d&&e.columnId===n);if(g){this._setValueState(e,u.Error,g.message);return}}this._setValueState(e,u.None,null)};A.prototype._isChildOrEqualControlId=function(e,t){if(e.getId()===t){return true}let r=e;while(r.getParent()){if(r.getParent().getId()===t){return true}r=r.getParent()}return false};A.prototype._resolveMessageTarget=function(e){let t=[];if(Array.isArray(e)){t=e}else{t.push(e)}const r=t.map(e=>{if(e.getBinding("value")){return e.getId()+"/value"}if(e.getBinding("selectedKey")){return e.getId()+"/selectedKey"}if(e.getBinding("selectedKeys")){return e.getId()+"/selectedKeys"}if(e.getBinding("selected")){return e.getId()+"/selected"}if(e.getBinding("selectedIndex")){return e.getId()+"/selectedIndex"}if(e.getBinding("selectedDates")){return e.getId()+"/selectedDates"}return undefined});if(r.length>0){return r}return r[0]};A.prototype._resolveBindingPropertyName=function(e){if(e.getBinding("value")){return"value"}if(e.getBinding("selectedKey")){return"selectedKey"}if(e.getBinding("selectedKeys")){return"selectedKeys"}if(e.getBinding("selected")){return"selected"}if(e.getBinding("selectedIndex")){return"selectedIndex"}if(e.getBinding("selectedDates")){return"selectedDates"}return undefined};A.prototype._isNullValue=function(e){if(!e.getValue&&!e.getSelectedKey&&!e.getSelectedKeys&&!e.getSelected&&!e.getSelectedIndex&&!e.getSelectedDates){return false}if(e.getValue||e.getSelectedKey||e.getSelectedKeys||e.getSelected){return!(e.getValue&&e.getValue()||e.getSelectedKey&&e.getSelectedKey()||e.getSelectedKeys&&e.getSelectedKeys().length>0||e.getSelected&&e.getSelected())}if(e.getSelectedIndex&&e.getSelectedIndex()>=0){return false}if(e.getSelectedDates){const t=e.getSelectedDates();if(t.length>0&&t[0].getStartDate()){return false}}return true};A.prototype._getRequiredErrorMessageTextByControl=function(e){const t="Required to input.";const r="Required to select.";if(e instanceof i){return this._getResourceText(this.RESOURCE_BUNDLE_KEY_REQUIRED_INPUT,t)}if(e.getSelectedKey||e.getSelectedKeys||e.getSelected||e.getSelectedIndex||e.getSelectedDates){return this._getResourceText(this.RESOURCE_BUNDLE_KEY_REQUIRED_SELECT,r)}return this._getResourceText(this.RESOURCE_BUNDLE_KEY_REQUIRED_INPUT,t)};A.prototype._getResourceText=function(e,t){if(this._resourceBundle){return this._resourceBundle.getText(e)}return t};A.prototype._getLabelText=function(e){if(e instanceof r&&e.getParent()){const t=g.getReferencingLabels(e.getParent());if(t&&t.length>0){const e=d.registry.get(t[0]);if(e&&e.getText){return e.getText()}}}if(e.getParent){const t=e.getParent();if(t instanceof C){const r=t;if(r.getParent()instanceof y){const t=r.getParent();const s=r.indexOfCell(e);if(s!==-1){const e=t.getColumns().filter(e=>e.getVisible())[s].getLabel();if(typeof e==="string"){return e}else if(e.getText){return e.getText()}}}return undefined}else if(t instanceof s){const r=t;if(r.getParent()instanceof o){const t=r.getParent();const s=r.indexOfCell(e);if(s!==-1){const e=t.getColumns().filter(e=>e.getVisible())[s].getHeader();if(e&&e.getText){return e.getText()}}}return undefined}}const t=g.getReferencingLabels(e);if(t&&t.length>0){const e=d.registry.get(t[0]);if(e&&e.getText){return e.getText()}}return undefined};A.prototype._addMessage=function(e,t,r,s,a){let i;let o;if(Array.isArray(e)){i=e[0];o=e}else{i=e;o=[e]}sap.ui.getCore().getMessageManager().addMessages(new m({message:t,type:c.Error,additionalText:a||this._getLabelText(i),processor:new h,target:this._resolveMessageTarget(e),fullTarget:r?r:"",validationErrorControlIds:o.map(e=>e.getId()),validateFunctionId:s||""}))};A.prototype._setValueState=function(e,t,r){if(e.setValueState){e.setValueState(t);if(t===u.Error){this._markSetValueStateError(e)}else if(t===u.None){this._unmarkSetValueStateError(e)}}if(e.setValueStateText){e.setValueStateText(r)}};A.prototype._isSetValueStateError=function(e){return e.data(this._CUSTOM_DATA_KEY_FOR_IS_SET_VALUE_STATE_ERROR)==="true"};A.prototype._markSetValueStateError=function(e){e.data(this._CUSTOM_DATA_KEY_FOR_IS_SET_VALUE_STATE_ERROR,"true")};A.prototype._unmarkSetValueStateError=function(e){e.data(this._CUSTOM_DATA_KEY_FOR_IS_SET_VALUE_STATE_ERROR,null)};const m=f.extend("learnin.ui5.validator.Validator._ValidatorMessage",{constructor:function(e){if(e&&Array.isArray(e.target)){if(!f.prototype.getTargets){this.targets=e.target;if(e.target.length>0){e.target=e.target[0]}else{delete e.target}f.call(this,e)}else{f.call(this,e)}}else{f.call(this,e)}this.validationErrorControlIds=[];if(e&&e.validationErrorControlIds&&Array.isArray(e.validationErrorControlIds)&&e.validationErrorControlIds.length>0){this.validationErrorControlIds=e.validationErrorControlIds;this.addControlId(e.validationErrorControlIds[0])}this.validateFunctionId="";if(e&&e.validateFunctionId){this.validateFunctionId=e.validateFunctionId}}});m.prototype.getTargets=function(){if(f.prototype.getTargets){return f.prototype.getTargets.call(this)}if(this.targets){return this.targets}return[]};m.prototype.getValidationErrorControlIds=function(){return this.validationErrorControlIds};m.prototype.getValidateFunctionId=function(){return this.validateFunctionId};return A});